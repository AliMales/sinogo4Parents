<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>title</title>
    <link rel="stylesheet" type="text/css" href="../../css/api.css"/>
    <link rel="stylesheet" type="text/css" href="../../css/style.css"/>
    <link rel="stylesheet" type="text/css" href="../../css/common.css"/>
    <style>
    	html,body{
    		background:#F6F6F6;
    		width:100%;
    	}
    	#header{
    		position: fixed;
    		top: 0;left:0;
    		width: 100%;
			height: 0.88rem;
			z-index: 5;
    	}
    	#header .btn_right{
			width: 0.95rem; height: 0.88rem;
			line-height: 0.88rem;
			font-size:0.3rem;
			position: absolute;
			top: 25px;
			right:0;
			text-align: center;
		}
		#header .btn_right.active{
			background: rgba(0,0,0,0.3)
		}
		#main{
			position: absolute;
			top:0.88rem;width:100%;
		}
		#content{
			height:4.8rem;
			background:#FFF;
    		position: fixed;
    		width: 100%;
    		z-index: 5;
		}
		#content:before{
			position: absolute;
			border-bottom: 1px #d9d9d9 solid;
			bottom: 0;left:0;right:0;
			content:"";display:block;
			-webkit-transform: scaleY(0.5);
			-webkit-transform-origin: 0 0;
		}
		#content .top{
			width:80%;
			margin-left:10%;
			height:1.25rem;
			padding-top:1.07rem;
		}
		#content .top img{
			width:1.25rem;
			height:1.25rem;
			margin-left:0.48rem;
			margin-right:0.48rem;
			float: left;
		}
		#content .top .top_right{
			float: left;
			height:1.25rem;
		}
		.method{
			font-size:0.32rem;
			color:#333;
			height:0.63rem;
			line-height:0.63rem;
		}
		.amount{
			font-size:0.32rem;
			color:#333;
			height:0.62rem;
			line-height:0.62rem;
		}
		.imp_sum{
			font-size:0.45rem;
			color:#1EBEB6;
		}
		#content .bottom{
			width:80%;
			margin-left:10%;
			height:0.85rem;
			margin-top: 0.9rem;
		}
		.bottom .btn{
			float:left;
			width:2.42rem;
			height:0.85rem;
			line-height:0.85rem;
			font-size:0.3rem;
			color:#333;
			text-align: center;
			border-radius:0.1rem;
		}
		.bottom .bleft{
			float:left;
		}
		.bottom .bright{
			float:right;
		}
		@media (-webkit-min-device-pixel-ratio:2) {
		    .raborder{
		   		box-shadow:0 0 0px 0.01rem rgb(153,153,153)
		    }
		}
		@media (-webkit-max-device-pixel-ratio:2) {
			.raborder{
	   			box-shadow:0 0 0px 1px rgb(153,153,153) 
		    }
		}
		.recommend-title{
			height: 1.18rem;
			line-height: 1.18rem;
			text-align: center;
			font-size:0.32rem;
			color:#FF8344;
			position: fixed;
			top:5.68rem;
			z-index: 5;
			width: 100%;
			background: #F6F6F6;
		}
		.recommend-title:before{
			border-bottom: 1px solid #d9d9d9;
			position: absolute;
			content:"";display:block;
			bottom:0;left:0;right:0;
			-webkit-transform: scaleY(0.5);
			-webkit-transform-origin: 0 0;
		}
		.recommend-title .span1{
			 background: linear-gradient(to right, red , blue);
			 background-size: 2rem 0.3rem;
			 height:0.3rem;
			 margin: auto 0.3rem;
			 width:2rem;
			 transform: scaleY(0.1);
			 transform-origin: 0 0;
		}
		.recommend-title .span2{
			 background: linear-gradient(to right, blue , red);
			 background-size: 2rem 0.3rem;
			 height:0.3rem;
			 margin: auto 0.3rem;
			 width:2rem;
			 transform: scaleY(0.1);
			 transform-origin: 0 0;
		}
		#recommend{
			position: absolute;
			width: 100%;
			top:6rem;
		}
		#recommend .listview {
			min-height: 3.1rem;
			background: #FFF;
			width: 100%;
		}
		.listview a {
			min-height:2.4rem;
			width: 100%;
			position :relative;
			background:#FFF;
		}
		.listview a.active {
			background:#F9F9F9 !important;
		}
		.listview .price{
			height:0.7rem;
			line-height:0.7rem;
			text-align: center;
			font-size:0.32rem;
			background:#FFF;
			color:#FF8344;
			position:relative;
		}
		.listview .price:before{
			position:absolute;
			border-top:dashed 1px #e6e6e6;
			top:0;left:0;right:0;
			content:"";display:block;
			-webkit-transform:scaleY(0.5);
			-webkit-transform-origin: 0 0;
		}
		.listview .price img{
			width:0.26rem;
			height:0.26rem;
		}
		.listview .price .pricespan{
			margin-left:0.1rem;
		}
		#recommend .pic {
			width: 2.12rem;
			height: 1.6rem;
			margin-left:0.24rem;
			margin-top:0.39rem;
			float:left;
		}
		#recommend #right {
			float:left;
			margin-left:0.22rem;
			margin-top:0.4rem;
			min-height:1.62rem;
			width:4.7rem;
		}
		#right .h2{
			font-size:0.28rem;
			color:#333333;
		}
		#right > div{
			font-size:0.22rem;
			color:#666666;
			margin-top:0.1rem;
		}
		#right .double{
			width:3rem;
			height: 0.32rem;
			line-height: 0.32rem;
		}
		#right .double img{
			width:0.24rem;
			height: 0.24rem;
			margin-right:0.1rem;
		}
		.starcontent{
			display: inline-block;
			padding: 0;
			margin: 0;
		}
		.starcontent .star{
			max-width:0.24rem;
			max-height:0.24rem;	
			width:0.24rem;
			height:0.24rem;
			float: left;
			margin-left: 0.06rem;
		}
		#right .ellipsis-1{
			display: -webkit-box;
			-webkit-line-clamp: 1;
			-webkit-box-orient: vertical;
			overflow: hidden;
			text-overflow: ellipsis;
			word-wrap: break-word;
			white-space: normal !important;
			height: 0.32rem;
		}
		#right .imp{
			color:#F48844;
		}
		.listview{
			position: relative;
			/*border-bottom: 0.01rem solid #CCCCCC;*/
		}
		.listview:after {
			border-bottom: 1px solid #c8c7cc;
			display: block;
			content: '';
			position: absolute;
			bottom: 0;
			right: 0;
			bottom: 0;
			left: 0;
			-webkit-transform-origin: 0 0;
			-webkit-transform: scaleY(0.5);
			pointer-events: none;
		}
		ul .current{
			color:#F76249;
		}
    </style>
</head>
<body>
	<div id="wrap" class="flex-wrap flex-vertical">
		<div id="header">
			<a class="back-icon" tapmode="active" onclick="btnRight()" ></a>
			<h1 id="title">支付成功</h1>
			<a tapmode="active" class="btn_right" onclick="btnRight()" >完成</a>
		</div>
		<div id="main" class="flex-con">
			<div id="content">
				<div class="top">
					<img src="../../image/icon_pay_success.png" alt="" />
					
					<div class="top_right">
						<div class="method">支付方式:在线支付</div>
						<div class="amount">订单金额: <span class="imp_sum">￥108</span></div>
					</div>
				</div>
				
				<div class="bottom">
					<div class="btn bleft raborder" onclick="goBillDetail()">查看订单</div>
					<div class="btn bright raborder" onclick="btnRight()">返回首页</div>
				</div>
			</div>
			<div class="recommend-title" style="display:none">
				<span>课程推荐</span>
			</div>
			<script type="text/x-dot-template" id="discover_template">
				{{ for(var i=0;i<it.length;i++){ }}
					<div class="listview">
						<a tapmode="active" onclick="goDetail({{=i}},'{{=it[i].classId}}','{{=it[i].courseId}}')"> 
							<img class="pic" src="{{=($api.imageUrl+it[i].courseImg)}}" onerror="onImgError(this)" alt="" />
							<div id="right">
								<h3 class="h2 ellipsis-2">{{=it[i].courseName}} {{=it[i].className}}</h3>
								<div>
									<span class="double">
										{{var length=it[i].score; if(!isInteger(length)){length=parseInt(length)} }}
										{{ for(var j=0;j<length;j++){ }}
											<img src="../../image/icon_star_whole.png" />
										{{ } }}
										{{ var length=it[i].score; if(!isInteger(length)){ }}
										<img src="../../image/icon_star_half.png" />
										{{ } }}
										&nbsp;&nbsp;<span class="imp">{{=it[i].score}}分</span>
									</span>
									已有: <span class="imp" >{{=it[i].registeredPeopers}}</span>人报名
								</div>
								<div>
									<span class="double">{{=it[i].teachingInstitutionName}}</span>
									距离:<span>{{=(it[i].distance||it[i].distance==0)?it[i].distance:''}}KM</span>
								</div>
							</div> 
						</a>
						<div class="price">
						<img src="../../image/icon_course_price.png" alt="" />
						<span class="pricespan">{{=it[i].coursePrice}}</span>
						</div>
					</div>
				{{ } }}
			</script>
			<div id="recommend" style="display:none">
			</div>
		</div>
	</div>
</body>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/common.js"></script>
<script type="text/javascript" src="../../script/doT.js"></script>
<script type="text/javascript" src="../../script/zepto.js"></script>
<script type="text/javascript">
	var orderNo;
	var orderType;
	imready = function(){
		handelVersionBelow4($api.dom(".btn_right").style)
		orderNo = api.pageParam.orderNo;
		orderType = api.pageParam.orderType;
		window.orderSum = api.pageParam.orderSum;
		$api.dom(".imp_sum").innerHTML="￥"+window.orderSum?window.orderSum:""
		api.addEventListener({
	        name:'keyback'
        },function(ret,err){
        	api.closeToWin({
		        name: 'root'
	        });
        });
        if(api.pageParam.orderType==2){//课程；
        	getCoursesList();
        }
	};
	
	
	function getCoursesList(){
		api.showProgress();
		var lat = api.getPrefs({sync:true,key:"latitude"});
		var lon = api.getPrefs({sync:true,key:"longitude"});
		var body={};
		body.method="recommendCourseList";
		body.request={
			"userId":api.getPrefs({sync:true,key:"userid"}),
			"latitude":lat,
			"longitude":lon,
			orderNo:orderNo
		}
		ajaxRequest(body,function(ret,err){
			api.hideProgress();
			api.refreshHeaderLoadDone();
			console.log(JSON.stringify(ret))
			if(ret){
				if(ret.responseCode==0){
					if(!ret.responseBody||ret.responseBody.length==0){
						
					}else{	
						window.courseList=ret.responseBody;
			        	$api.dom(".recommend-title").style.display="block"
			        	$api.dom("#recommend").style.display="block"
						getInnerByDot("recommend","discover_template",window.courseList)
					}
				}else{
				}
			}else{
			}
		})
	}
	
	function goDetail(index,classid,courseid){
		var pageParam = {
			classId : classid,
			courseId : courseid,
			courseInfo : window.courseList[index]
		}
		console.log("frame1pageParam数据"+JSON.stringify(pageParam))
		openWin("coursedetail","../discover",pageParam)
	}
	
	function isInteger(x) {
	    return x % 1 === 0;
	}

	
	function goBillDetail(){
		//前往已支付的订单详情.
//		if(orderType==1){//教辅
			api.openWin({
				name : 'orderDetailsTitle',
				url : '../mine/myorder/orderDetailsTitle.html',
				pageParam : {
					info : {orderNo:orderNo},
					tag:-1
				}
			});
//		}else{//课程
////			api.openWin({
////	            name: 'orderPaymentCourse',
////	            url: 'orderPaymentCourse.html',
////	            reload:true,
////	            pageParam:{
////	            	type:2,
////	            	orderNo:orderNo,
////	            	userInfo:window.userInfo,
////	            	comeFrom:'paysuccess'
////	            }
////	        });
//		}
	}
	
	function btnRight(){
		//返回首页
		api.closeToWin({
	        name: 'root'
        });
	}
	
</script>
</html>