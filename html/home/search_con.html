<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>title</title>
    <link rel="stylesheet" type="text/css" href="../../css/api.css"/>
    <link rel="stylesheet" type="text/css" href="../../css/common.css"/>
    <style>
    	html,body{
    		height:100%;
    		background: #F6F6F6;
    	}
    	#main{
    		height:100%;
    	}
    	#guide{
    		position:fixed;
			top: 0;
    	}
    	#recent{
    		height:0.88rem;
    		background:url(../../image/icon_arrow_right.png) no-repeat right 0.23rem center #FFF;
    		background-size:0.16rem 0.28rem;
    		position: relative;
    	}
    	#recent:after{
    		border-bottom:1px solid #c1c1c1;
    		position: absolute;
    		top:0.88rem;
			right: 0;
			bottom: 0;
			left: 0;
    		display: block;
    		content:'';
    		pointer-events:none;
    		transform-origin: 0 0;
    		transform: scaleY(0.5);
    		-webkit-transform-origin: 0 0;
    		-webkit-transform: scaleY(0.5);
    	}
    	#recent a{
    		font-size:0.24rem;
    		color:#adacac;
    		float:left;
    		width: 6.8rem;
    		height:0.88rem;
    		line-height:0.88rem;
    		background:url(../../image/icon_history.png) no-repeat left 0.23rem center;
    		background-size:0.28rem 0.28rem;
    		padding-left:0.7rem;
    	}
    	#recent a.active{
    		background:url(../../image/icon_history.png) no-repeat left 0.23rem center rgba(0,0,0,0.1);
    		background-size:0.28rem 0.28rem;
    	}
    	#history{
    		width:100%;
    		background:#FFF;
    	}
    	#history #history_title{
    		height:0.88rem;
    		margin-left:0.23rem;
    		margin-right:0.23rem;
    		background:url(../../image/icon_arrow_down.png) no-repeat right center;
    		background-size:0.28rem 0.16rem;
    		position: relative;
    	}
    	#history #history_title:after{
    		border-bottom:1px solid #E1E1E1;
    		position: absolute;
			right: 0;
			bottom: 0;
			left: 0;
    		display: block;
    		content:'';
    		pointer-events:none;
    		-webkit-transform-origin: 0 0;
    		-webkit-transform: scaleY(0.5);
    	}
    	#history #history_title span{
    		font-size:0.24rem;
    		color:#adacac;
    		float:left;
    		height:0.88rem;
    		line-height:0.88rem;
    		background:url(../../image/icon_search_light.png) no-repeat left center;
    		background-size:0.26rem 0.26rem;
    		padding-left:0.47rem;
    	}
    	
    	#history #history_content div{
    		font-size:0.24rem;
    		margin-left:0.23rem;
    		margin-right:0.23rem;
    		color:#777777;
    		height:0.88rem;
    		line-height:0.88rem;
    		position: relative;
    	}
    	#history #history_content div:after{
    		border-bottom:1px solid #E1E1E1;
    		position: absolute;
			right: 0;
			bottom: 0;
			left: 0;
    		display: block;
    		content:'';
    		pointer-events:none;
    		-webkit-transform-origin: 0 0;
    		-webkit-transform: scaleY(0.5);
    	}
    	#history #history_content div a{
    		width: 6.55rem;
    		height:100%;
    		padding-left:0.5rem;
    		background:#FFF;
    	}
    	#history #history_content div a.active{
    		background:#F9F9F9 !important;
    	}
		.listview {
			position: relative;
			padding-left: 0;
			background-color: #fff;
			/*height:1.6rem;*/
		}
		.listview.active {
			background-color: #F9F9F9;
		}
		.listview:after {
			border-top: 1px solid #c1c1c1;
			display: block;
			content: '';
			position: absolute;
			top: 0;
			right: 0;
			bottom: 0;
			left: 0;
			transform-origin: 0 0;
			transform: scaleY(0.5);
			-webkit-transform-origin: 0 0;
			-webkit-transform: scaleY(0.5);
			pointer-events: none;
		}
		.listview-cell {
			position: relative;
			padding: 0.32rem 0.23rem;
			overflow: hidden;
			-webkit-transform-style: preserve-3d;
			transform-style: preserve-3d;
			-webkit-touch-callout: none;
		}
		.listview .list-img, .listview .list-img-body {
			overflow: hidden;
		}
		.list-img-body{
			/*color:#333333;
			font-size:0.28rem;*/
			
		}
		.list-img-title{
			color:#333333;
			font-size:0.28rem;
			/*line-height:1.3;*/
		}
		.listview .list-img-object {
			width:1.04rem;
			height: 0.94rem;
		}
		.listview .list-img-object.list-pull-left {
			margin-right: 0.21rem;
		}
		.list-pull-left {
			float: left !important;
		}
		.list-ellipsis-2 {
			display: -webkit-box;
			-webkit-line-clamp: 2;
			-webkit-box-orient: vertical;
			overflow: hidden;
			text-overflow: ellipsis;
			word-wrap: break-word;
			white-space: normal !important;
			color:#666666;
			font-size:0.22rem;
		}
		#empty{
			width:100%;
			height:100%;
			text-align: center;
			
		}
		#empty div{
			height:30%;
			background:url(../../image/icon_empty.png) no-repeat center bottom ;
			background-size:2.35rem 2.35rem;
		}
		#empty label{
			margin-top:0.5rem;
			color:#666666;
			font-size:0.34rem;
		}
    </style>
</head>
<body>
	<div id="main">
		
		<script type="text/x-dot-template" id="news_template">
			{{ for(var i=0; i< it.length; i++) { }}
			<div class="listview" tapmode="active">
				<div class="listview-cell list-img" onclick="openNewsDetail('{{=it[i].id}}')">
					<img class="list-img-object list-pull-left" src="{{=it[i].url}}">
					<div class="list-img-body">
						<div class="list-img-title">{{=it[i].title}}</div>
						<p class="list-ellipsis-2">
							{{=it[i].summary}}
						</p>
					</div>
				</div>
			</div>
			{{ } }}
		</script>
		<div id="list_content">
		</div>
		<div id="empty" style="display:none">
			<div></div>
			<label for="">未搜到结果</label>
		</div>
		<div id="guide">
			<div id="recent">
				<a tapmode='active'>最近浏览</a>
			</div>
			<script id="history_template" type="text/x-dot-template">
				{{ for(var i=0;i<it.length;i++){ }}
					<div ><a  tapmode="active" onclick="searchByKey('{{=it[i]}}');">{{=it[i]}}</a></div>
				{{ } }}
			</script>
			<div id="history">
				<div id="history_title">
					<span>历史搜索</span>
				</div>
				<div id="history_content">
				</div>
			</div>
		</div>
	</div>
</body>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/common.js"></script>
<script type="text/javascript" src="../../script/doT.js"></script>
<script type="text/javascript">
	imready = function(){
		initHistory();
	};
	
	function handleGuide(s){
		if(s){
			initHistory()
		}
		$api.byId("guide").style.display=s?"block":"none";
	}
	
	function initHistory(){
		var arr = getHistoryArr();
		if(arr.length==0){
			$api.byId("history").style.display="none";
        	return;
		}
		var list = [];
		for(var i=0;i<arr.length;i++){
			list.push(arr[i])
		}
		var content = $api.byId("history_content");
		var tpl = $api.byId("history_template").text;
		var tempFn = doT.template(tpl);
		content.innerHTML=tempFn(list)
	}
	function searchByKey(keyword){
		var arr = getHistoryArr();
		var list = [];
		for(var i=0;i<arr.length;i++){
			if(keyword!=arr[i]){
				list.push(arr[i])
			}
		}
		list.unshift(keyword);
		var str ="";
		for(var i=0;i<list.length;i++){
			str +=",";
			str +=list[i];
		}
		api.setPrefs({
	        key:'news_search_history',
	        value:str
        });
        api.execScript({
        	name:'search',
	        script: "setInput('"+keyword+"');"
        });
        //goSearch
        handleGuide(false)
        api.showProgress();
       	setTimeout("getCourses();",1000);
	}
	
	function getCourses(){
	 	api.hideProgress();
		if(Math.floor(Math.random()*2)==0){
			$api.byId("empty").style.display="block"
			$api.byId("list_content").style.display="none"
			 handleGuide(false);
			return;
		}
		$api.byId("empty").style.display="none"
		$api.byId("list_content").style.display="block"
		var data = [];
		for (var i = 0; i < 10; i++) {
			var json = {
				id : "BD12300" + i,
				url : "../../image/p" + (i) % 4 + ".jpg",
				title : "2016体坛风云人物初评名单揭晓",
				summary : "11月25日，2016年度体坛风云人物初评名单正式揭晓。围棋世界冠军柯洁、唐韦星、军队棋队2016年度体坛风云人物初评名单正式揭晓。围棋世界冠军柯洁、唐韦星、军队棋队..." 
			}
			data.push(json);
		}
		var content = $api.byId('list_content');
		var tpl = $api.byId('news_template').text;
		var tempFn = doT.template(tpl);
		content.innerHTML = tempFn(data);
	}
	
	function getHistoryStr(){
		var news_search_history = api.getPrefs({
	        sync:true,
	        key:'news_search_history'
        });
        return news_search_history;
	}
	
	function getHistoryArr(){
		var str = getHistoryStr();
		if(str){
			str = str.substring(1)
			if(str){
				return str.split(",")
			}else{
				return [];
			}
		}else{
			return [];
		}
		
	}
	
	
	
</script>
</html>