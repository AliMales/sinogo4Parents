<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
	<title>title</title>
	<link rel="stylesheet" type="text/css" href="../../css/api.css" />
	<link rel="stylesheet" type="text/css" href="../../css/chessstyle_831.css">
	<style>
		.job_msg {
			height: 1.31rem;
			width: 100%;
		}

		.job_msg div:nth-child(1) p:nth-child(1) span {
			font-size: .28rem;
			color: #333;
			margin-left: .28rem;
			line-height: .655rem;
		}

		.job_msg div:nth-child(1) p:nth-child(2) span {
			font-size: .26rem;
			color: #666;
			margin-left: .28rem;
			line-height: .655rem;
		}
		/********************作业******************/

		#main .question-answer {
			margin-top: 0.1rem;
			padding-bottom: 0.1rem;
		}

		.container {
			width: 100%;
			background: rgba(255, 255, 255, 0.45);
			/*height: 8.62rem;*/
			overflow-y: auto;
			position: relative;
		}

		.title {
			width: 6.96rem;
			position: relative;
		}

		.container h3 {
			height: 0.86rem;
			width: auto;
			background: #f6f6f6;
			border-left: solid 0.06rem #a05150;
		}

		.container h3 span {
			margin-left: 0.28rem;
			font-size: 0.28rem;
			line-height: 0.86rem;
			color: #333;
			font-weight: normal;
		}

		.container h3 img {
			height: 0.28rem;
			width: 0.29rem;
			margin: 0.29rem 0 0 0.23rem;
		}

		.q-title {
			margin-top: 0.29rem;
			color: #1ebeb6;
			font-size: 0.3rem;
			margin-left: 0.32rem;
			word-wrap: break-word
		}

		.container .q-title-icon-wrong {
			position: absolute;
			width: 0.44rem;
			height: 0.57rem;
			background: url(../../image/icon_answer_error.png) no-repeat center center;
			background-size: 100%;
			right: 0.24rem;
			top: 0.1rem;
		}

		.container .q-title-icon-ding {
			position: absolute;
			right: 0.24rem;
			top: 0.1rem;
			color: #666;
			font-size: 0.26rem;
		}

		.container .q-title-icon-right {
			position: absolute;
			width: 0.44rem;
			height: 0.57rem;
			background: url(../../image/icon_answer_right.png) no-repeat center center;
			background-size: 100%;
			right: 0.24rem;
			top: 0.1rem;
		}

		.q-audio {
			position: absolute;
			top: -0.95rem;
			right: 0.2rem;
			width: 0.5rem;
			height: 0.5rem;
			background: url(../../image/icon_audio.png) no-repeat center center;
			background-size: 0.29rem 0.25rem;
		}

		.content {
			width: 5.12rem;
			margin: 0 auto;
		}

		.q-img img {
			width: 100%;
			display: block;
		}

		.q-audio audio {
			width: 100%;
		}

		.q-video video {
			width: 100%;
		}

		.content .q-sgf {
			width: 5.5rem;
			height: 5.5rem;
			background: #FFF;
			margin: 0 auto;
			border-radius: 0.2rem;
			overflow: hidden;
		}

		.content .q-sgf-height {
			height: 12rem;
		}

		.rightanswer {
			width: 5.5rem;
		}

		.rightanswer .radios {
			width: 100%;
			height: 1.04rem;
			line-height: 1.04rem;
			margin: 0 auto;
			position: relative;
		}

		.answer {
			width: 5.9rem;
			margin: 0.4rem auto 0.63rem;
		}

		.answer ul li {
			min-height: 0.9rem;
			padding: 0.2rem 0;
			font-size: 0.26rem;
			padding-left: 0.4rem;
			box-sizing: border-box;
			background: #eee;
			color: #333;
			margin-bottom: 0.08rem;
			position: relative;
			border-radius: 0.05rem;
		}

		.answer .showrightanswer {
			min-height: 0.9rem;
			padding: 0.2rem 0;
			font-size: 0.26rem;
			padding-left: 0.8rem;
			box-sizing: border-box;
			background: url(../../image/icon_right_anser.png) no-repeat center center;
			background-size: 5.9rem 0.9rem;
			color: #FFF;
			margin-bottom: 0.08rem;
			position: relative;
			border-radius: 0.05rem;
		}

		.answer ul li i {
			position: absolute;
			top: 0.2rem;
			right: 0.2rem;
			width: 0.5rem;
			height: 0.5rem;
			background: url(../../image/icon_audio.png) no-repeat center center;
			background-size: 0.29rem 0.25rem;
		}

		.answer ul li.active {
			background: #ff8344;
			color: #fff;
		}

		.answer ul li.active i {
			background: url(../../image/icon_audio_white.png) no-repeat center center;
			background-size: 0.29rem 0.25rem;
		}

		.answer ul li img {
			max-width: 5.1rem;
			margin: 0 auto;
		}

		.my_answer_w {
			background: #ff8344!important;
		}

		.my_answer_w span {
			color: #FFF;
		}

		.my_answer_r {
			background: #1ebeb6!important;
		}

		.my_answer_r span {
			color: #FFF;
		}
		[v-cloak] {
				display: none;
		}
	</style>
</head>

<body>
	<div id="wrap" class="flex-wrap flex-vertical" >
		<div id="main" class="flex-con" v-cloak>
			<section class="job_msg">
				<div>
					<p><span>{{pageParam | job_name}}</span></p>
					<p><span>{{pageParam.job.homeworkTitle}}&nbsp共{{pageParam.job.questionCount}}题</span></p>
				</div>
				<div class="question-answer">
					<div class="container" v-for="(question,i) in pageParam.jobDetalis.questionAttributeList ">
						<span class="q-title-icon-right" v-if="pageParam.jobDetalis.answerQuestionsList[i].answerIsRight==true">&nbsp;</span>
						<span class="q-title-icon-wrong" v-if="pageParam.jobDetalis.answerQuestionsList[i].answerIsRight==false">&nbsp;</span>
						<h3><span>难度</span><img v-for="start in question.difficultyValue" src="../../image/icon_start.png" alt=""></h3>
						<div class="title" v-for="(questionItem,index) in question.questionTitleAttributes" v-cloak>
							<div class="q-title" v-if="questionItem.titleTypeValue==-1">
								{{(i+1)}} .{{questionItem.titleDetails}}
							</div>
							<div class="q-audio" v-if="questionItem.titleTypeValue==-2"></div>
						</div>
						<div class="content" v-for="questionItem in question.questionTitleAttributes" v-cloak>
							<div class="q-img" v-if="questionItem.titleTypeValue==0">
								<img :src="questionItem.titleDetails" alt="" />
							</div>
							<div class="q-audio" v-if="questionItem.titleTypeValue==1">
								<audio :src="questionItem.titleDetails" controls="controls"></audio>
							</div>
							<div class="q-video" v-if="questionItem.titleTypeValue==2">
								<video :src="questionItem.titleDetails" controls="controls"></video>
							</div>
							<div :class="[{'q-sgf':true},{'q-sgf-height':showAnswer&&showAnswerOrNot(questionItem.titleDetails,pageParam.jobDetalis.answerQuestionsList[i].answerIsRight)}]" :q-sgf="questionItem.titleDetails" :q-id="'qid-'+question.questionId" :q-a-id="'qid-a-'+question.questionId"
											:answerIsRight="pageParam.jobDetalis.answerQuestionsList[i].answerIsRight" :answerSgf="pageParam.jobDetalis.answerQuestionsList[i].answerSgfText" :boardSize="question.boardSize" v-if="questionItem.titleTypeValue==3">
								<div :id="'qid-'+question.questionId" class="chessboard"></div>
								<div class="rightanswer" v-if="showAnswer&&showAnswerOrNot(questionItem.titleDetails,pageParam.jobDetalis.answerQuestionsList[i].answerIsRight)">
									<div class="radios">
										<div class="triangle-down"></div>
									</div>
									<div :id="'qid-a-'+question.questionId" class="chessboard1"></div>
								</div>
							</div>
						</div>
						<div class="answer">
							<ul>
								<li :class="[{'right_answer':optionItem.optionRight},{'my_answer_w':isMyAnswer(pageParam.jobDetalis.answerQuestionsList[i],index)}]" v-for="(optionItem,index) in question.questionOptionsAttributes" v-cloak>
									<span class="optionId" style="display: none">{{optionItem.optionId}}</span>
									<span class="optionRight" style="display: none">{{optionItem.optionRight}}</span>
									<div v-for="optionContent in optionItem.questionOptions">
										<span v-if="optionContent.optionTypeValue==-1">{{optionItem.optionName}}.{{optionContent.optionDetails}}</span>
										<img :src="optionContent.optionDetails" v-if="optionContent.optionTypeValue==0" alt="" />
										<i v-if="optionContent.optionTypeValue==-3" @click="audioPlay(optionContent.optionDetails)"></i>
									</div>
								</li>
								<div class="showrightanswer" v-if="(question.questionTypeValue==1||question.questionTypeValue==-1)&&showAnswer==true&&pageParam.jobDetalis.answerQuestionsList[i].answerIsRight==false">
									<span>答案：{{getRightAnswer(question.questionOptionsAttributes)}}</span>
								</div>
							</ul>
						</div>
					</div>
				</div>
			</section>
		</div>
</body>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/common.js"></script>
<script type="text/javascript" src="../../script/vue.min.js"></script>
<script type="text/javascript" src="../../script/jquery-3.1.1.js"></script>
<script type="text/javascript" src="../../script/zepto.js"></script>
<script src="../../script/chessboard_831.js"></script>
<script type="text/javascript" src="../../script/sgfutils.js"></script>
<script type="text/javascript">
	var task; //全局控制器Controller

	var showRight = false;
	var showAnswer = false;
	var letters = "abcdefghijklmnopqrstuvwxyz";
	initVue = function() { //初始化Vue需要的是双向数据绑定 当改变数据以后view会做相应的改变
		var data = vueDateManager();
		var methods = vueMethodsManager();
		task = new Vue({
			el: '#main', //绑定元素
			data: data, //本页面的静态动态全部数据
			methods: methods, //本页面的全部方法
			updated: function() {
				//在这里，并加载所有sgf题目，奈斯。
				api.showProgress({});
				var sgfs = $api.domAll(".q-sgf");
				for (var i = 0; i < sgfs.length; i++) {
					var el = $(sgfs[i]);
					var id = el.attr('q-id'); //所有参数都存在这里。
					var sgf = el.attr('q-sgf');
					var boardSize = el.attr("boardSize");
					var answerIsRight = el.attr("answerIsRight");
					var answerSgf = el.attr("answerSgf");
					createBoard(id, boardSize);
					var a = parseSGF(sgf);
					answers = a.answer;
					initLayout(a.question_layout, id, boardSize);
					answerSgf = "(" + answerSgf + ")"
					var myAnswer = getAnswers(answerSgf)
					autoPlay(myAnswer, id, boardSize);

					//是否需要显示第二棋盘
					var showMore = task.showAnswerOrNot(sgf, answerIsRight);
					console.log("showMore === === === " + showMore)
					var w = 518 / 750 * window.screen.width
					var itemw = parseFloat(w / boardSize);
					w = itemw * boardSize;
					if (showRight && showMore == true) { //需要显示更多
						var sgfJson = parseSGF(sgf);
						var answers = sgfJson.answer;
						var id1 = el.attr('q-a-id');
						var index = compareAnswers(myAnswer[0], answers);
						createBoard1(id1, boardSize);
						initAnswerLayout(sgfJson.question_layout, id1, boardSize);
						var radios = el.find(".radios")[0]
						initRadios(radios, answers.length, index, id1, sgf);
						initView1(w, itemw, id1);
						drawAnswer(answers[index], id1, boardSize);
					} else { //不需要
					}
					initView1(w, itemw, id);
				}
				api.hideProgress();
			}
		})
	}
	Vue.filter('job_name', function(value) { //开始时间过滤器
		if (!isEmpty(value)) {
			value = value.job.publishDate;
			var a = new Array("日", "一", "二", "三", "四", "五", "六");
			var week = new Date(value.substring(0, 10)).getDay();
			var str = "周" + a[week];
			value = value.substring(5, 7) + "月" + value.substring(8, 10) + "日 " + str + " " + value.substring(11, 16);
		}
		return value;
	})

	function compareAnswers(myanswer, answers) {
		if (!myanswer || !$.isArray(myanswer)) {
			return 0;
		}
		var flag = true;
		var index = 0;
		for (m in answers) {
			var answer = answers[m];
			if (myanswer.length == answer.length) {
				flag = true;
				for (x in myanswer) {
					var a = myanswer[x];
					for (y in answer) {
						var b = answer[y];
						if (b.id == a.id && b.name == a.name && b.color == a.color) {
							break;
						} else {
							flag = false;
						}
					}
					if (flag == false) {
						break;
					} else {}
				}
				if (flag == false) {} else {}
			} else {
				flag = false;
			}
			if (flag == false) {} else {
				index = m;
				break;
			}
		}
		return index;
	}

	function drawAnswer(answer, id, boardSize) {
		var a = answer;
		if (a.length > 0) {
			for (var i = 0; i < a.length; i++) {
				var sub = a[i];
				sub.id = sub.id + '-' + id
				pushStones(sub, (i), boardSize);
			}
		} else {
			return;
		}
	}

	function initRadios(radios, l, index, id, sgf) {
		var w1 = 550 / 750 * window.screen.width;
		var answerWidth = w1 / (l + 1);
		var margin = answerWidth / (l + 1) - 2;
		var h = 90 / 750 * window.screen.width;
		var index = 0;
		for (var i = 0; i < l; i++) {
			var _div = $('<div>');
			_div.addClass('answer-select');
			if (i == index) {
				_div.addClass('current');
			}
			var left = (i + 1) * margin + (i) * answerWidth + 1 / 2 * answerWidth - 8;
			_div.attr('index', i);
			_div.attr('triangle-left', left + 'px');
			_div.click(function() {
				if ($(this).hasClass('current')) {
					return;
				}
				selectAnswer($(this), $(this).attr('index'), id, sgf)
			})
			_div.attr('id', "answer_" + i);
			_div.html("答案：" + (i + 1));
			$(radios).append(_div);
		}
		$(radios).children(".triangle-down").css("top", (h - 11) + 'px')
		$(radios).children(".triangle-down").css("left", $(radios).children('.current').attr('triangle-left'))
		$(radios).children(".answer-select").css("width", answerWidth + "px");
		$(radios).children(".answer-select").css("margin-left", margin + "px");
		$(radios).children(".answer-select").css("font-size", 24 / 750 * window.screen.width + "px");
		$(radios).children(".answer-select").css("height", (h * 3) / 4 + 'px');
		$(radios).children(".answer-select").css("line-height", (h * 3) / 4 + 'px');
	}

	function selectAnswer(el, index, id, sgf) {
		var sgfJson = parseSGF(sgf);
		var answers = sgfJson.answer;
		var parent = el.parent();
		var grandParent = parent.parent();
		var ch1 = grandParent.children(".chessboard1")
		parent.children(".current").removeClass("current")
			//$(".radios .current").removeClass("current")
		el.addClass("current");
		parent.children(".triangle-down").css("left", parent.children('.current').attr('triangle-left'))
			//$(".chessboard1").html("");
		var boardSize = sgfJson.board_size;
		createBoard1(id, boardSize);
		initAnswerLayout(sgfJson.question_layout, id, boardSize);
		drawAnswer(answers[index], id, boardSize);
		var w = 518 / 750 * window.screen.width
		var itemw = parseFloat(w / boardSize);
		w = itemw * boardSize;
		initView1(w, itemw, id);
	}

	vueDateManager = function() {
		//初始化Vue数据date为一个json数组
		var data = {};
		data.pageParam = {
			"jobDetalis": {
				"questionAttributeList": [{
					"questionTypeName": "",
					"questionId": 0,
					"questionOptionsAttributes": [{
						"optionId": 0,
						"optionName": "",
						"optionRight": 0,
						"questionId": 0,
						"questionOptions": [{
							"optionTypeName": "",
							"optionTypeValue": 0,
							"optionDetails": ""
						}],
						"optionValue": 0
					}],
					"drawChessBoard": 0,
					"knowledgeId": 0,
					"difficultyValue": 0,
					"questionTypeValue": 0,
					"subjectName": "",
					"difficultyName": "",
					"subjectId": 0,
					"knowledgeName": "",
					"boardSize": 0,
					"programmeId": 0,
					"programmeName": "",
					"questionTitleAttributes": [{
						"titleTypeValue": 0,
						"titleDetails": "",
						"titleTypeName": ""
					}]
				}],
				"answerQuestionsList": [{
					"id": 0,
					"createTime": "",
					"answerCostTime": 0,
					"answerSgfText": "",
					"choiceOptionId": 0,
					"homeWorkId": 0,
					"choiceOptionSequence": 0,
					"questionId": 0,
					"studentId": 0,
					"answerIsRight": 0,
					"questionType": 0
				}],
				"boardSize": 0,
				"programmeId": 0,
				"subjectId": 0,
				"knowledgeId": 0,
				"knowledgeName": "",
				"drawChessBoard": 0,
				"programmeName": "",
				"questionTypeName": "",
				"subjectName": "",
				"questionId": 0,
				"questionTypeValue": 0,
				"difficultyName": "",
				"difficultyValue": 0
			},
			"job": {
				"questionCount": 0,
				"courseName": "",
				"homeWorkStudentId": 0,
				"homeworkPublishId": 0,
				"monthStr": "0",
				"className": "",
				"studentWorkStatus": 0,
				"limitDate": "",
				"studentScore": 0,
				"courseCategory": "",
				"month": 0,
				"homeworkTitle": "",
				"publishDate": ""
			}
		};

		console.log("数据管理者" + JSON.stringify(data));
		return data;

	}
	vueMethodsManager = function() {
			var methods = {};
			methods.init = function() {
				task.pageParam = api.pageParam;
				console.log("pageParam参数：++++++++++++++++++++++++++++++" + JSON.stringify(task.pageParam));
			};
			methods.getRightAnswer = function(optionsAttributes) {
				var answers = '';
				for (var i = 0; i < optionsAttributes.length; i++) {
					if (optionsAttributes[i].optionRight) {
						answers += "，"
						answers += optionsAttributes[i].optionName;
					}
				}
				answers = answers.substr(1, answers.length - 1)
				return answers
			}
			methods.isMyAnswer = function(ret, index) {
				if (ret.data && ret.data.length > 1) {
					for (var i = 0; i < ret.data.length; i++) {
						if (index == ret.data[i].choiceOptionSequence) {
							return true;
						}
					}
					return false;
				} else {
					return index == ret.choiceOptionSequence;
				}
			}
			methods.showAnswerOrNot = function(sgf, answerIsRight) {
				var qq = parseSGF(sgf);
				var answer = qq.answer;
				if (answer.length <= 1) { //单个答案
					//保持高度不变。
					if (answer.length == 0) {
						return false;
					} else {
						if (answerIsRight == true) { //如果回答正确则不显示
							return false;
						} else { //回答错误，仍然显示正确答案
							return true;
						}
					}
				} else { //多答案，无论正确与否都显示多答案
					return true;
				}
			}
			methods.iframeLoaded = function(e) {
				var el = e.target; //当前控件
				if (!el) {
					el = e;
				}
				var loaded = $(el).attr("loaded");
				console.log(loaded)
				if (loaded == 'true') {
					console.log("加载完了吧")
					return;
				}
				//获取属性，即可使用
				var src = "weiqiResult.html";

				var sgf = $(el).attr("sgf");
				var boardSize = $(el).attr("boardSize");
				var answerIsRight = false;
				var answerSgf = "";
				var showRight = false;

				console.log("sgf===" + sgf)

				src += "?sgf=" + sgf + "&boardSize=" + boardSize + "&answerIsRight=" + answerIsRight + "&answerSgf=" + answerSgf + "&showRight=" + showRight;
				$(el).attr("src", src);
				$(el).attr("loaded", "true");
			}

			return methods;

		}
		// initVue();
	imready = function() {
		// $api.fixStatusBar($api.dom("header"));
		initVue();
		task.init();

	}
</script>

</html>
