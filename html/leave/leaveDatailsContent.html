<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
		<meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
		<title>title</title>
		<link rel="stylesheet" type="text/css" href="../../css/api.css"/>
		<link rel="stylesheet" type="text/css" href="../../css/style.css"/>
		<style>
			.flex-wrap {
				background: #f6f6f6;
			}
			header {
				z-index: 1000;
				position: fixed;
				top: 0;
				height: 0.88rem;
				background: #FF8344;
				border-top-color: #EEEEEE;
				color: #FFFFFF;
				display: -webkit-flex; /* 新版本语法: Chrome 21+ */
				display: flex; /* 新版本语法: Opera 12.1, Firefox 22+ */
				display: -webkit-box; /* 老版本语法: Safari, iOS, Android browser, older           WebKit browsers. */
				display: -moz-box; /* 老版本语法: Firefox (buggy) */
				display: -ms-flexbox; /* 混合版本语法: IE 10 */
				width: 100%;
				border-top: #EEEEEE solid 0.01rem;
				margin-top: 0;
			}
			.tit-left {
				width: 0%;
				display: block;
				-webkit-flex: 1; /* Chrome */
				-ms-flex: 1; /* IE 10 */
				flex: 1; /* NEW, Spec - Opera 12.1, Firefox 20+ */
				-webkit-box-flex: 1; /* OLD - iOS 6-, Safari 3.1-6 */
				-moz-box-flex: 1; /* OLD - Firefox 19- */
				text-align: left;
				-webkit-box-sizing: border-box;
				-moz-box-sizing: border-box;
				box-sizing: border-box;
			}
			.tit-con {
				text-align: center;
				font-size: 0.34rem;
				display: block;
				-webkit-flex: 5; /* Chrome */
				-ms-flex: 5; /* IE 10 */
				flex: 5; /* NEW, Spec - Opera 12.1, Firefox 20+ */
				-webkit-box-flex: 5; /* OLD - iOS 6-, Safari 3.1-6 */
				-moz-box-flex: 5; /* OLD - Firefox 19- */
				-webkit-box-sizing: border-box;
				-moz-box-sizing: border-box;
				box-sizing: border-box;
				height: 0.88rem;
				line-height: 0.88rem;
			}
			.tit-right {
				width: 0%;
				display: block;
				-webkit-flex: 1; /* Chrome */
				-ms-flex: 1; /* IE 10 */
				flex: 1; /* NEW, Spec - Opera 12.1, Firefox 20+ */
				-webkit-box-flex: 1; /* OLD - iOS 6-, Safari 3.1-6 */
				-moz-box-flex: 1; /* OLD - Firefox 19- */
				text-align: right;
				-webkit-box-sizing: border-box;
				-moz-box-sizing: border-box;
				box-sizing: border-box;
				background: #FF8345;
			}
			.back {
				display: inline-block;
				color: #FFFFFF;
				text-align: center;
				background: url(../../image/back.png);
				background-size: cover;
				margin-left: 0.23rem;
				width: 0.24rem;
				height: 0.45rem;
				margin-top: 0.215rem;
			}
			.h-title {
				position: absolute;
				z-index: 999;
				top: 0.88rem;
				overflow: hidden;
				width: 100%;
			}
			.title {
				height: 2.37rem;
				background: #FFFFFF;
				display: -webkit-flex; /* 新版本语法: Chrome 21+ */
				display: flex; /* 新版本语法: Opera 12.1, Firefox 22+ */
				display: -webkit-box; /* 老版本语法: Safari, iOS, Android browser, older           WebKit browsers. */
				display: -moz-box; /* 老版本语法: Firefox (buggy) */
				display: -ms-flexbox; /* 混合版本语法: IE 10 */
			}
			.marding {
				height: 0.29rem;
				width: 100%;
				background: #f6f6f6;
				display: inline-block;
			}
			.tleft {
				margin-top: 0.3rem;
				margin-left: 0.23rem;
				display: inline-block;
				height: 1.62rem;
				width: 2.58rem;
				background: url(../../image/mine/mylesson.png);
				background-size: cover;
			}
			.mtleft {
				height: 1.62rem;
				width: 2.58rem;
			}
			.tright {
				display: block;
				-webkit-flex: 1; /* Chrome */
				-ms-flex: 1; /* IE 10 */
				flex: 1; /* NEW, Spec - Opera 12.1, Firefox 20+ */
				-webkit-box-flex: 1; /* OLD - iOS 6-, Safari 3.1-6 */
				-moz-box-flex: 1; /* OLD - Firefox 19- */
				margin-left: 0.38rem;
				margin-top: 0.3rem;
				margin-right: 0.23rem;
			}
			.p1 {
				text-align: left;
				line-height: 0.293rem;
				letter-spacing: -0.01rem;
				color: #333333;
				font-size: 0.26rem;
				text-overflow: -o-ellipsis-lastline !important;
				overflow: hidden;
				text-overflow: ellipsis !important;
				display: -webkit-box;
				-webkit-line-clamp: 3 !important;
				-webkit-box-orient: vertical;
			}
			.p2 {
				color: #666666;
				font-size: 0.24rem;
				margin-top: 0.28rem;
				overflow: hidden;
				text-overflow: ellipsis;
				white-space: nowrap;
				word-break: keep-all;
			}
			.p3 {
				color: #666666;
				font-size: 0.24rem;
				overflow: hidden;
				text-overflow: ellipsis;
				white-space: nowrap;
				word-break: keep-all;
			}
			.edugroup {
				color: #FF8345
			}
			.value {
				background: #FFFFFF;
			}
			.nine {
				width: 100%;
				display: block;
				height: 2.20rem;
				background: #FFFFFF;
				position: relative;
			}
			.checkbox {
				width: 0.36rem;
				float: left;
				height: 2.20rem;
			}
			.rel {
				position: relative;
			}
			.circle {
				z-index: 1;
				border: 0.01rem solid #eeeeee;
				height: 0.42rem;
				width: 0.42rem;
				left: 0.15rem;
				top: 0.88rem;
				position: absolute;
				border-radius: 50%;
				background-color: #eeeeee;
			}
			.circle-a {
				z-index: 1;
				border: 0.01rem solid #eeeeee;
				height: 0.42rem;
				width: 0.42rem;
				left: 0.15rem;
				top: 0.88rem;
				position: absolute;
				border-radius: 50%;
				background-color: #FF8345;
			}
			.circle-sm {
				height: 0.24rem;
				width: 0.24rem;
				left: 0.09rem;
				top: 0.09rem;
				position: absolute;
				border-radius: 50%;
				background-color: #FF8345;
			}
			.right {
				float: right;
				overflow: hidden;
				width: 7.06rem;
				height: 2.20rem;
			}
			.nine:after {
				border-bottom: 1px solid #d9d9d9;
				content: "";
				display: block;
				position: absolute;
				bottom: 0;
				left: 0;
				right: 0;
				-webkit-transform-origin: 0 0;
				-webkit-transform: scaleY(0.5);
			}
			.lesstit {
				display: -webkit-flex; /* 新版本语法: Chrome 21+ */
				display: flex; /* 新版本语法: Opera 12.1, Firefox 22+ */
				display: -webkit-box; /* 老版本语法: Safari, iOS, Android browser, older           WebKit browsers. */
				display: -moz-box; /* 老版本语法: Firefox (buggy) */
				display: -ms-flexbox; /* 混合版本语法: IE 10 */
				margin-left: 0.48rem;
				margin-top: 0.84rem;
				position: relative;
			}
			.lessnum {
				display: inline-block;
				font-size: 0.26rem;
				color: #666666;
			}
			.lessontime {
				display: inline-block;
				font-size: 0.24rem;
				color: #666666;
				margin-left: 0.5rem;
			}
			.leaveStatus {
			    position:absolute;
				display: inline-block;
				font-size: 0.24rem;
				color: #666666;
				text-align: right;
				margin-right: 0.23rem;
				right: 0.23rem;

			}
			.con {
				margin-top: 0.23rem;
				margin-left: 0.48rem;
			}
			.teacher {
				font-size: 0.24rem;
				color: #999999;
				float: left;
			}
			.state {
				font-size: 0.24rem;
				float: right;
				color: #1A9973;
				margin-right: 0.3rem;
			}
			.state-un {
				font-size: 0.24rem;
				float: right;
				color: #ff8344;
				margin-right: 0.3rem;
			}
			.endtab {
				z-index: 999;
				position: fixed;
				bottom: 0;
				height: 0.98rem;
				background: #f6f6f6;
				border-top-color: #EEEEEE;
				width: 100%;
				border-top: #EEEEEE solid 1px;
				text-align: center;
				color: #666666;
				font-size: 0.34rem;
				margin-bottom: 0;
				line-height: 0.98rem;
			}
			.mendtab {
				height: 1rem;
			}
			.tranfer {
				display: -webkit-flex; /* 新版本语法: Chrome 21+ */
				display: flex; /* 新版本语法: Opera 12.1, Firefox 22+ */
				display: -webkit-box; /* 老版本语法: Safari, iOS, Android browser, older           WebKit browsers. */
				display: -moz-box; /* 老版本语法: Firefox (buggy) */
				display: -ms-flexbox; /* 混合版本语法: IE 10 */
				width: 0%;
				display: block;
				-webkit-flex: 1; /* Chrome */
				-ms-flex: 1; /* IE 10 */
				flex: 1; /* NEW, Spec - Opera 12.1, Firefox 20+ */
				-webkit-box-flex: 1; /* OLD - iOS 6-, Safari 3.1-6 */
				-moz-box-flex: 1; /* OLD - Firefox 19- */
				position: relative;
			}
			.tranfer:after {
				border-right: 1px solid #eeeeee;
				content: "";
				display: block;
				position: absolute;
				bottom: 0;
				top: 0;
				right: 0;
				-webkit-transform-origin: 0 0;
				-webkit-transform: scaleX(0.5);
			}
			.askteacher {
				display: inline-block;
				width: 0%;
				display: block;
				-webkit-flex: 1; /* Chrome */
				-ms-flex: 1; /* IE 10 */
				flex: 1; /* NEW, Spec - Opera 12.1, Firefox 20+ */
				-webkit-box-flex: 1; /* OLD - iOS 6-, Safari 3.1-6 */
				-moz-box-flex: 1;
			}
			.imgtran {
				display: inline-block;
				width: 0.56rem;
				height: 0.52rem;
				margin-top: 0.2rem;
				margin-left: 0.77rem;
				background: url(../../image/mine/transferapplication.png);
				background-size: cover;
			}
			.tranask {
				display: inline-block;
				margin-left: 0.44rem;
				font-size: 0.3rem;
				margin-top: 0.3rem;
				color: #666666;
			}
			.maskte {
				display: inline-block;
				width: 0.56rem;
				height: 0.52rem;
				margin-top: 0.2rem;
				margin-left: 0.77rem;
				background: url(../../image/mine/askteacher.png);
				background-size: cover;
			}
			.touch {
				background: #D9D9D9;
			}
			.lessonnum {
				font-size: 0.28rem;
			}
			.nothingbox {
				height: 3.54rem;
				width: 100%;
			}
			.img {
				height: 0.42rem;
				width: 0.42rem;
				margin-top: 0.89rem;
				margin-left: 0.23rem;
			}
			.active {
				background: url(../../image/mine/leave_unchoose.png) no-repeat;
				background-size: 100%;
			}
			.default {
				background: url(../../image/mine/leave_choose.png) no-repeat;
				background-size: 100%;
			}
		</style>
	</head>
	<body >
	</body>
	<!-- 将类型设置为template，标识为doT.JS -->
	<script type="template" id="dotTmpl">
		{{for(var i = 0 ; i<it.length;i++){}}
		<div class="nine" onclick="selectTimeTable('{{=i}}','{{=it[i].timetableId}}','{{=it[i].tag}}')">
		<div class="checkbox">
		<div class="img active" ></div>
		</div>
		<div class="right">
		<div class="lesstit">
		<div class="lessonnum">
		第{{=it[i].coursePeriod}}课时
		</div>
		<div class="lessontime">
		{{=it[i].time}}
		</div>
		<div class="leaveStatus">
		{{=it[i].leaveStatus}}
		</div>
		</div>
		<div class="con">
		<div class="teacher">
		老师：{{=it[i].teacher}}
		</div>
		<div {{ if( it[i].ring == '0'){ }}
		class="state"
		{{  }else{ }}
		class="state-un"
		{{ } }}>
		{{=it[i].state}}
		</div>
		</div>
		</div>
		</div>
		{{  } }}
		<div class="mendtab">
		</div>
		</div>
		<div class="endtab" onclick="handLeave()">
		申请请假
		</div>
		</div>
	</script>
	<script type="text/javascript" src="../../script/api.js"></script>
	<script type="text/javascript" src="../../script/doT.js"></script>
	<script type="text/javascript" src="../../script/common.js"></script>
	<script type="text/javascript">
		var lessonInfo;
		//id盒子
		var timeTableBox = [];
		var tableInfo = "";
		var mdate;
		function json() {
			var date = [];
			var r = [0, 1];
			var a = ['已完成', '即将开课'];
			for (var i = 0; i < lessonInfo.length; i++) {
				var romnumber = parseInt(Math.random() * 2);
				var olist = {};
				if (lessonInfo[i].isFinish && lessonInfo[i].isStart) {
					olist.ring = r[0];
					olist.state = a[0];
				} else {
					olist.ring = r[1];
					olist.state = a[1];
				}
				timeTableBox.push(lessonInfo[i].timetableId);
				olist.timetableId = lessonInfo[i].timetableId;
				olist.coursePeriod = lessonInfo[i].coursePeriod;
				olist.time =lessonInfo[i].schoolTime.substring(5, 10)+" "+ lessonInfo[i].schoolTime.substring(11, 16) + "-" + lessonInfo[i].quittingTime.substring(11, 16);
				if(lessonInfo[i].leaveAuditStatus==0){
				olist.tag=-1;
				olist.leaveStatus ="请假处理中"
				}else if(lessonInfo[i].leaveAuditStatus==1){
				olist.tag=-1;
				// olist.leaveStatus ="请假审核中"
				// ***********************0925修改***************8
				olist.leaveStatus = "请假成功"
							}else if(lessonInfo[i].leaveAuditStatus==2){
				olist.tag=-1;
				olist.leaveStatus = "请假成功"
				}else if(lessonInfo[i].leaveAuditStatus==null){
				olist.leaveStatus = " "
				olist.tag=0;
				}
				olist.teacher = lessonInfo[i].classTeacher;
				date.push(olist);
			}
			var tmpl = doT.template($api.text($api.dom('#dotTmpl')));
			$api.html($api.dom("body"), tmpl(date));
			if (api.pageParam.tag < 0) {
				$api.css($api.dom(".endtab"), "display:none");
			}
		}

		function selectTimeTable(i, id,tag) {
		if(tag==-1){
			api.toast({
		        msg:'本节课程不能重复请假'
	        });
		}else{
			var mdate = [];
			api.parseTapmode();
			var a = $api.domAll('.img');
			if ($api.hasCls(a[i], 'active')) {
				$api.removeCls(a[i], 'active');
				$api.addCls(a[i], 'default');
			} else {
				$api.removeCls(a[i], 'default');
				$api.addCls(a[i], 'active');
			}
			for (var i = 0; i < a.length; i++) {
				mdate.push(false);
			}
			for (var j = 0; j < a.length; j++) {
				if ($api.hasCls(a[j], 'active')) {
					mdate[j] = false;
				} else {
					mdate[j] = true;
				}
			}
			tableInfo = ""
			for (var i = 0; i < timeTableBox.length; i++) {
				if (mdate[i]) {
					if (tableInfo != "") {
						$api.css($api.dom(".endtab"), "background: #f6f6f6;");
						tableInfo = tableInfo+ timeTableBox[i] + "," ;
					} else {
						tableInfo = tableInfo + timeTableBox[i]+",";
					}
				}
			}
			if (tableInfo != "") {
				$api.css($api.dom(".endtab"), "background: #ff8344;color:#fff;");
			} else {
				$api.css($api.dom(".endtab"), "background: #f6f6f6;color:#666666;");
			}


		}
		}

		function handLeave() {
			if (tableInfo != "") {
				api.openFrame({
					name : 'mleavaReason',
					url : 'leavaReason.html',
					rect : {
						x : 0,
						y : 0,
						w : api.winWidth,
						h : api.winHeight
					},
					pageParam : {
						studentId : api.pageParam.studentId,
						classTimetableIds : tableInfo
					},
					bounces : false,
				});
			} else {
				api.toast({
					msg : '请先选择要请假的课时！'
				});
			}
		}

		var responseBody;
		function httptodo(ret) {
			responseBody = ret.responseBody;
			if (responseBody != null && responseBody.length != 0) {
				responseBody = ret.responseBody;
				json();
			}
		}

		imready = function() {
			if (api.pageParam.studentTimetables.length > 0) {
				lessonInfo = api.pageParam.studentTimetables;
				console.log(JSON.stringify(lessonInfo));
				json();
			} else {
				api.toast({
					msg : '现在暂时无课时，耐心等待~'
				});
			}
			if(api.pageParam.tag==-1){
			$api.css($api.dom(".endtab"),"display:none");
			}
			//			getHotCities();
		};
	</script>
</html>
