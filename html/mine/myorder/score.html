<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
	<meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
	<title>title</title>
	<link rel="stylesheet" type="text/css" href="../../../css/api.css" />
	<link rel="stylesheet" type="text/css" href="../../../css/style.css" />
	<style>
		body {}

		.flex-wrap {
			background: #F6F6F6;
		}

		header {
			background: #FF8345;
			height: 0.88rem;
			line-height: 0.88rem;
			text-align: center;
			display: -webkit-flex;
			/* 新版本语法: Chrome 21+ */
			display: flex;
			/* 新版本语法: Opera 12.1, Firefox 22+ */
			display: -webkit-box;
			/* 老版本语法: Safari, iOS, Android browser, older           WebKit browsers. */
			display: -moz-box;
			/* 老版本语法: Firefox (buggy) */
			display: -ms-flexbox;
			/* 混合版本语法: IE 10 */
			color: #323237;
			position: relative;
			font-size: 0.28rem;
			color: #ffffff;
		}

		.left {
			display: inline-block;
			text-align: left;
			margin-left: 0.23rem;
			margin-top: 0.175rem;
			width: 0.24rem;
			height: 0.45rem;
			background: url(../../../image/back.png);
			background-size: cover;
		}

		.center {
			display: block;
			-webkit-flex: 1;
			/* Chrome */
			-ms-flex: 1;
			/* IE 10 */
			flex: 1;
			/* NEW, Spec - Opera 12.1, Firefox 20+ */
			-webkit-box-flex: 1;
			/* OLD - iOS 6-, Safari 3.1-6 */
			-moz-box-flex: 1;
			/* OLD - Firefox 19- */
			font-size: 0.34rem;
			line-height: 0.88rem;
		}

		.right {
			text-align: left;
			display: inline-block;
			margin-left: 0.23rem;
			margin-top: 0.175rem;
			width: 0.24rem;
			height: 0.45rem;
			background-size: cover;
		}

		.content {
			background: #FFFFFF;
		}

		.tips {
			-webkit-box-sizing: border-box;
			-moz-box-sizing: border-box;
			box-sizing: border-box;
			height: 0.88rem;
			font-size: 0.28rem;
			padding-left: 0.23rem;
			color: #666666;
			background: #FFFFFF;
			line-height: 0.88rem;
		}

		.box {
			width: 100%;
			background: #FFFFFF;
		}

		.mbox {
			height: 2.43rem;
			width: 7.04rem;
			border: #D9D9D9 solid 0.01rem;
			background: #FFFFFF;
			margin-left: 0.23rem;
		}

		.text {
			height: 2.43rem;
			width: 7.04rem;
			padding: 0.1rem;
			font-size: 0.26rem;
			-webkit-box-sizing: border-box;
			-moz-box-sizing: border-box;
			box-sizing: border-box;
			border: #d9d9d9 solid 1px;
			outline: none;
		}

		.scorebox {
			margin-left: 0.23rem;
			height: 0.88rem;
			border-bottom: #d9d9d9 solid 0.01rem;
			display: -webkit-flex;
			/* 新版本语法: Chrome 21+ */
			display: flex;
			/* 新版本语法: Opera 12.1, Firefox 22+ */
			display: -webkit-box;
			/* 老版本语法: Safari, iOS, Android browser, older           WebKit browsers. */
			display: -moz-box;
			/* 老版本语法: Firefox (buggy) */
			display: -ms-flexbox;
			/* 混合版本语法: IE 10 */
		}

		.scoretips {
			line-height: 0.88rem;
			display: inline-block;
			color: #666666;
			font-size: 0.28rem;
		}

		.start {
			width: 0.32rem;
			height: 0.30rem;
			margin-left: 0.2rem;
			margin-top: 0.29rem;
		}

		.default {
			background: url(../../../image/mine/startf.png);
			background-size: 100%;
		}

		.active {
			background: url(../../../image/mine/startt.png);
			background-size: 100%;
		}

		.mscorebox {
			margin-left: 0.23rem;
			height: 0.88rem;
			border-bottom: #d9d9d9 solid 0.01rem;
			display: -webkit-flex;
			/* 新版本语法: Chrome 21+ */
			display: flex;
			/* 新版本语法: Opera 12.1, Firefox 22+ */
			display: -webkit-box;
			/* 老版本语法: Safari, iOS, Android browser, older           WebKit browsers. */
			display: -moz-box;
			/* 老版本语法: Firefox (buggy) */
			display: -ms-flexbox;
			/* 混合版本语法: IE 10 */
		}

		.mscoretips {
			line-height: 0.88rem;
			display: inline-block;
			color: #666666;
			font-size: 0.28rem;
		}

		.mstart {
			width: 0.32rem;
			height: 0.30rem;
			margin-left: 0.2rem;
			margin-top: 0.29rem;
		}

		.mdefault {
			background: url(../../../image/mine/startf.png);
			background-size: cover;
		}

		.mactive {
			background: url(../../../image/mine/startt.png);
			background-size: cover;
		}

		.end {
			background: #FFFFFF;
			margin-top: 0.4rem;
		}

		.endtab {
			position: fixed;
			bottom: 0;
			height: 0.98rem;
			background: #aaaaaa;
			border-top-color: #EEEEEE;
			text-align: center;
			line-height: 0.98rem;
			width: 100%;
			border-top: #EEEEEE solid 0.01rem;
			margin-bottom: 0;
			color: #FFFFFF;
			font-size: 0.32rem;
		}

		.touch {
			background: #e2743c;
		}
	</style>
</head>

<body>
	<div id="wrap" class="flex-wrap flex-vertical">
		<header>
			<div class="left" onclick="cancel()"></div>
			<div class="center">
				评分
			</div>
			<div class="right"></div>
		</header>
		<div id="main" class="flex-con">
			<div class="content">
				<p class="tips">
					请为该课程老师做出评论和评分
				</p>
				<div class="box">
					<div class="mbox">
						<textarea class="text lesson" oninput="OnInput (event)"></textarea>
					</div>
				</div>
				<hr style="background: #d9d9d9; height: 0.01rem;width: 100% ; margin-top: 0.32rem;" />
				<div class="scorebox">
					<p class="scoretips">
						评分：
					</p>
					<div class="start active" onclick="start(0)"></div>
					<div class="start active" onclick="start(1)"></div>
					<div class="start active" onclick="start(2)"></div>
					<div class="start active" onclick="start(3)"></div>
					<div class="start active" onclick="start(4)"></div>
				</div>
			</div>
			<div class="end">
				<p class="tips">
					请为课程辅导用品打分
				</p>
				<div class="box">
					<div class="mbox">
						<textarea class="text book" oninput="OnInput (event)"></textarea>
					</div>
					<hr style="background: #d9d9d9; height: 0.01rem;width: 100% ; margin-top: 0.32rem;" />
					<div class="mscorebox">
						<p class="mscoretips">
							评分：
						</p>
						<div class="mstart mactive" onclick="mstart(0)"></div>
						<div class="mstart mactive" onclick="mstart(1)"></div>
						<div class="mstart mactive" onclick="mstart(2)"></div>
						<div class="mstart mactive" onclick="mstart(3)"></div>
						<div class="mstart mactive" onclick="mstart(4)"></div>
					</div>
				</div>
			</div>
		</div>
		<div class="endtab" onclick="commit()">
			发表评论
		</div>
</body>
<script type="text/javascript" src="../../../script/api.js"></script>
<script type="text/javascript" src="../../../script/common.js"></script>
<script type="text/javascript">
	var canSumit = false;
	var isfirst;
	var startNumber = 5;
	var type = -1;//1教辅2课程
	var commentContentValue = "";

	function commit() {
		console.log(canSumit+"==="+type);

		if (canSumit) {
			if (type > 0) { //判断当前评论的类型1为书本2为课程
				if (type === 1) {
					commentContentValue =  $api.val($api.dom('.book'));
				} else if (type === 2) {
					commentContentValue =   $api.val($api.dom('.lesson'));
				}
			}
			ajaxRequestcommit();

		}

	};

	function ajaxRequestcommit() {
		$api.css($api.dom('.endtab'), 'background: #aaaaaa;');
		var date = {};
		date.method = "businessCommentsCreate";
		var systemType;
		if (api.systemType == "ios") {
			systemType = 1
		} else if (api.systemType == "android") {
			systemType = 2
		}
		console.log(commentContentValue);
		date.request = {
			"orderNo": api.pageParam.orderNo.orderNo,
			"goodsId": api.pageParam.orderNo.goodsOrderDetails[0].goodsNo,
			"commentType": api.pageParam.orderNo.goodsOrderDetails[0].goodsType, //1是教辅，2课程
			"commentStar": startNumber,
			"commentContent": commentContentValue,
			"commentFrom": systemType,
			"userId": api.getPrefs({
				sync: true,
				key: 'userid'
			})
		};
		api.showProgress();
		console.log("评分请求详情数据：" + JSON.stringify(date));
		ajaxRequest(date, function(ret, err) {
			api.hideProgress();
			if (ret) {
				console.log("评分请求成功返回数据：" + JSON.stringify(ret));
				if (ret.responseCode == 0) {
					if (ret.responseBody) {
						alert("恭喜，评价成功！")
						api.closeToWin({
							name : 'root'
						});
					} else {
						alert("评价失败,请稍后重试。")
						api.closeToWin({
							name : 'root'
						});
					}
				}
			} else {
				console.log("评分请求失败返回数据：" + JSON.stringify(err));
				alert("评价失败,请稍后重试。")
				api.closeToWin({
					name : 'root'
				});
			}
		})
	}

	function OnInput(event) {
		var book = $api.val($api.dom('.book'));
		var lesson = $api.val($api.dom('.lesson'));
		if (isEmpty(book) && isEmpty(lesson)) {
			$api.css($api.dom('.endtab'), 'background: #aaaaaa;');
			canSumit = false;
		} else {
			$api.css($api.dom('.endtab'), 'background: #ff8344;');
			canSumit = true;
		}
	}

	//第一个星级评分的监听事件
	function start(tag) {
		var start = $api.domAll('.start');
		for (var i = 0; i < start.length; i++) {
			$api.removeCls(start[i], 'active');
			$api.addCls(start[i], 'default');
		}
		for (var j = 0; j <= tag; j++) {
			$api.removeCls(start[j], 'default');
			$api.addCls(start[j], 'active');
		}
		startNumber = tag + 1;
	}

	//第二个星级评分的监听事件
	function mstart(tag) {
		var start = $api.domAll('.mstart');
		for (var i = 0; i < start.length; i++) {
			$api.removeCls(start[i], 'mactive');
			$api.addCls(start[i], 'mdefault');
		}
		for (var j = 0; j <= tag; j++) {
			$api.removeCls(start[j], 'mdefault');
			$api.addCls(start[j], 'mactive');
		}
		startNumber = tag + 1;
	}

	function cancel() {
		api.closeWin({});
	}

	imready = function() {
		console.log(JSON.stringify(api.pageParam));
		console.log(JSON.stringify(api.pageParam.orderNo.goodsOrderDetails[0].goodsType));
		if (api.pageParam.orderNo.goodsOrderDetails[0].goodsType == 1) { //1代表的是教辅，2代表课程
			$api.css($api.dom(".content"), "display:none");
			type = 1;
		} else if (api.pageParam.orderNo.goodsOrderDetails[0].goodsType == 2) {
			$api.css($api.dom(".end"), "display:none");
			type = 2
		}
	};
</script>

</html>
